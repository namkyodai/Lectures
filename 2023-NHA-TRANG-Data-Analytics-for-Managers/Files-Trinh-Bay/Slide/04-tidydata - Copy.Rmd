---
title     : "Các Nguyên Lý Cơ Bản Trong Phân Tích Dữ Liệu"
subtitle  : "Làm Sạch và Hợp Thức Hóa Dữ Liệu, Dữ Liệu Gọn Gàng"
author    : "[TS. Lê Thanh Nam](https://namkyodai.github.io)"
date      : "4-tháng 8-2023"
#date      : "`r format(Sys.time(), '%d %B, %Y')`"
output    : 
  slidy_presentation:
#   css: assets/css/styles.css
#   css: assets/css/ribbons.css
    mathjax: local
    self_contained: false
    font_adjustment: 0
    fig_width: 7
    fig_height: 6
    fig_caption: true
    incremental: false #for bullet increment
    highlight: pygments
    footer: "Bản Quyền của Cty TNHH ASQ Việt Nam - Chuẩn Bị cho Khóa Học tại Đại Học UEH"
    includes:
      in_header: assets/layouts/header.html
      #before_body: doc_prefix.html
      #after_body: doc_suffix.html
    duration: 45
---



## Data Cleansing and Validation (1)

> Data cleansing or data cleaning is the process of detecting and correcting (or removing) corrupt or inaccurate records from a record set, table, or database and refers to identifying incomplete, incorrect, inaccurate or irrelevant parts of the data and then replacing, modifying, or deleting the dirty or coarse data. Data cleansing may be performed interactively with data wrangling tools, or as batch processing through scripting
>
> `r tufte::quote_footer('--- https://en.wikipedia.org/wiki/Data_cleansing')`

<span style="color: red;"> Data scientists spend **60% of their time on cleaning** and organizing data. Collecting data sets comes second at 19% of their time, meaning data scientists spend around **80% of their time on preparing and managing data for analysis**.</span>


> Data Validation is an activity verifying whether or not a combination of values is a member of a set of acceptable combinations
>
> `r tufte::quote_footer('--- [Zio et al. 2016](https://ec.europa.eu/eurostat/cros/system/files/methodology_for_data_validation_v1.0_rev-2016-06_final.pdf)')`


## Data Cleansing and Validation (2)


<div class='left' style='float:left;width:48%'>

```{r, echo=FALSE, out.width="100%", fig.cap="", fig.align = 'center'}
knitr::include_graphics("assets/img/data-validationprocess.png")
```

Source: [Methodology for Data Valication 1.0](https://ec.europa.eu/eurostat/cros/system/files/methodology_for_data_validation_v1.0_rev-2016-06_final.pdf)

</div>

<div class='right' style='float:right;width:48%'>

- Validation Level 0: consistency with the expected IT structural requirements

- Validation Level 1: consistency within the data set
- Validation Level 2:  consistency with other data sets within the same domain and within the same data source
- Validation Level 3:  consistency within the same domain between different data sources
- Validation Level 4:  consistency between separate domains in the same data provider 
- Validation Level 5: consistency with data of other data providers.

</div>

## Tidy Data - Structure

<div class='left' style='float:left;width:48%'>

**Untidy**

Typical representation

```{r echo=FALSE, message=FALSE,warning=FALSE}
library(readxl)
library(dplyr)
# library(ggplot2)
data=read_excel("../data/tidydata.xlsx",sheet="treatment01")
library(knitr)
library(kableExtra)
options(knitr.kable.NA = '')
data %>%
  kbl() %>%
#  kable_classic(full_width = F, html_font = "Cambria")
  kable_paper(bootstrap_options = "striped", full_width = F,font_size = 22)
#kable(data, booktabs = TRUE)
```


Another typical representation

```{r echo=FALSE, message=FALSE,warning=FALSE}
# library(ggplot2)
data=read_excel("../data/tidydata.xlsx",sheet="treatment02")
data %>%
  kbl() %>%
#  kable_classic(full_width = F, html_font = "Cambria")
  kable_paper(bootstrap_options = "striped", full_width = F,font_size = 22)
#kable(data, booktabs = TRUE)
```

- What are the <span style="color: red;">**variable**</span>, <span style="color: red;">**observation**</span>, <span style="color: red;">**value**</span>?

</div>


<div class='right' style='float:right;width:48%'>
> Happy families are all alike; every unhappy family is unhappy in its own way
>
> `r tufte::quote_footer('--- Leo Tolstoy')`


Like families, tidy datasets are all alike but every messy dataset is messy in its own way. Tidy datasets provide a standardized way to link the structure of a dataset (its physical layout) with its semantics (its meaning).

```{r, echo=FALSE, out.width="60%", fig.cap="", fig.align = 'center'}
knitr::include_graphics("assets/img/tidydata.png")
```

</div>

## Tidy Data - Definition

<div class='left' style='float:left;width:48%'>

A dataset is a collection of <span style="color: red;">**values**</span>, usually either numbers (if quantitative) or strings (if qualitative). Values are organised in two ways. Every value belongs to a <span style="color: red;">**variable**</span> and an <span style="color: red;">**observation**</span>. A variable contains all values that measure the same underlying attribute (like height, temperature, duration) across units. An observation contains all values measured on the same unit (like a person, or a day, or a race) across attributes.


```{r, echo=FALSE, out.width="90%", fig.cap="", fig.align = 'center'}
knitr::include_graphics("assets/img/tidydata_2.jpg")
```

source: [Openscapes](https://www.openscapes.org/blog/2020/10/12/tidy-data/)
</div>

<div class='right' style='float:right;width:48%'>

**Tidy data is a standard way of mapping the meaning of a dataset to its structure. A dataset is messy or tidy depending on how rows, columns and tables are matched up with observations, variables and types.** In tidy data:

  - Each variable forms a column.
  - Each observation forms a row.
  - Each type of observational unit forms a table.

```{r echo=FALSE, message=FALSE,warning=FALSE}
# library(ggplot2)
data=read_excel("../data/tidydata.xlsx",sheet="treatment03")
data %>%
  kbl() %>%
#  kable_classic(full_width = F, html_font = "Cambria")
  kable_paper(bootstrap_options = "striped", full_width = F,font_size = 22)
#kable(data, booktabs = TRUE)
```

</div>


## Tidy Data - Tydy Our Room with Marie Kondo's Way (KONMARI)

<div class='left' style='float:left;width:48%'>

```{r, echo=FALSE, out.width="60%", fig.cap="", fig.align = 'center'}
url <- "https://kenh14cdn.com/thumb_w/620/2019/1/30/artboard-1-copy-3-1548865803939988101634.jpg"
knitr::include_graphics(url)
#knitr::include_graphics("../Visual/data-atomic.png")
```

[Phương pháp Marie Kondo: Nghệ thuật dọn dẹp nhà cửa](https://www.btaskee.com/kinh-nghiem-hay/don-dep-nha-voi-phuong-phap-marie-kondo/)

</div>

<div class='right' style='float:right;width:48%'>

Folding a perfect underwear drawer

<iframe width="560" height="315" src="https://www.youtube.com/embed/tglp9eWQEhY" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>

Organize the world: Design Your Life to Spark Joy

<iframe width="560" height="315" src="https://www.youtube.com/embed/rAC4sprfqgU" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>


</div>

## Tidying Messy Data (1)

<div class='left' style='float:left;width:48%'>
- Column headers are values, not variable names.

- Multiple variables are stored in one column.

- Variables are stored in both rows and columns.

- Multiple types of observational units are stored in the same table.

- A single observational unit is stored in multiple tables
</div>

<div class='left' style='float:left;width:48%'>
```{r, echo=FALSE, out.width="90%", fig.cap="", fig.align = 'center'}
url = "https://www.openscapes.org/img/blog/tidydata/tidydata_3.jpg"
knitr::include_graphics(url)
```
source: [Openscapes](https://www.openscapes.org/blog/2020/10/12/tidy-data/)

</div>

## Column headers are values, not variable names (1)


<div class='left' style='float:left;width:48%'>

Messy Data


```{r echo=FALSE, message=FALSE,warning=FALSE}
library(readxl)
library(dplyr)
# library(ggplot2)
data=read.csv("../data/tidy-data/data/pew-raw.csv", sep=",", header=TRUE)
data <-data%>%select(c(2:8))
#colnames(data) <- c('religion','<$10k','$10-20k','$20-30k','$30-40k','$40-50k','$50-75k')
library(DT)
p<-datatable(data,rownames = FALSE)
p
#library(knitr)
#library(kableExtra)
#data %>% 
#  kbl() %>%
#  kable_classic(full_width = F, html_font = "Cambria")
#  kable_paper(bootstrap_options = "striped", full_width = F,font_size = 22)
#kable(data, booktabs = TRUE)
```


</div>

<div class='right' style='float:left;width:15%'>

```{r, echo=FALSE, out.width="90%", fig.cap="", fig.align = 'center'}
url = "https://hotemoji.com/images/dl/i/black-rightwards-arrow-emoji-by-twitter.png"
knitr::include_graphics(url)
```

- Variables

  - religion
  - income
  - frequency
  
</div>

<div class='right' style='float:left;width:30%'>

Tidy Data

```{r echo=FALSE, message=FALSE,warning=FALSE}
source("../code/pew-tidying.R")
library(DT)
p<-datatable(molten.df,rownames = FALSE,
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left', targets = c(1,2)))
            ,autoWidth = TRUE)
             )
p
```

</div>

## Column headers are values, not variable names (2)

Billboard Ranking

```{r echo=FALSE, message=FALSE,warning=FALSE}
df=read.csv("../data/tidy-data/data/billboard.csv", sep=",", header=TRUE)
p<-datatable(df,rownames = FALSE,extensions = c('FixedColumns'),
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left'))
            ,autoWidth = TRUE,scrollX = TRUE,fixedColumns = TRUE)
             )
p
```



## Column headers are values, not variable names (3)

Billboard Ranking

```{r echo=FALSE, message=FALSE,warning=FALSE}
source("../data/tidy-data/data/billboard.r")
p<-datatable(clean,rownames = FALSE,
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left', targets = c(1,2,3,4,5,6)))
            ,autoWidth = TRUE)
             )
p
```

## Multiple variables stored in one column (1)

WHO data on turboculis (TB)

```{r echo=FALSE, message=FALSE,warning=FALSE}
df=read.csv("../data/tidy-data/data/tb.csv", sep=",", header=TRUE)
p<-datatable(df,rownames = FALSE,extensions = c('FixedColumns'),
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left'))
            ,autoWidth = TRUE,scrollX = TRUE,fixedColumns = TRUE)
             )
p
```


## Multiple variables stored in one column (2)

```{r echo=FALSE, message=FALSE,warning=FALSE}
source("../data/tidy-data/data/tb.r")
library(DT)
p<-datatable(raw,rownames = FALSE,extensions = c('FixedColumns'),
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left'))
            ,autoWidth = TRUE,scrollX = TRUE,fixedColumns = TRUE)
             )
p
```

## Multiple variables stored in one column (3)


<div class='right' style='float:left;width:45%'>

```{r echo=FALSE, message=FALSE,warning=FALSE}
source("../data/tidy-data/data/tb.r")
library(DT)
p<-datatable(clean1,rownames = FALSE,
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left'))
            ,autoWidth = TRUE)
             )
p
```

</div>

<div class='right' style='float:left;width:10%'>
```{r, echo=FALSE, out.width="90%", fig.cap="", fig.align = 'center'}
url = "https://hotemoji.com/images/dl/i/black-rightwards-arrow-emoji-by-twitter.png"
knitr::include_graphics(url)
```
</div>

<div class='right' style='float:left;width:45%'>
```{r echo=FALSE, message=FALSE,warning=FALSE}
source("../data/tidy-data/data/tb.r")
library(DT)
p<-datatable(clean,rownames = FALSE,
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left'))
            ,autoWidth = TRUE)
             )
p
```
</div>


## Variables are stored in both rows and columns (1)

Global Historical Climatology Network for one weather station (MX17004)



```{r echo=FALSE, message=FALSE,warning=FALSE}
source("../data/tidy-data/data/weather.r")
library(DT)
p<-datatable(raw,rownames = FALSE,extensions = c('FixedColumns'),
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left'))
            ,autoWidth = TRUE,scrollX = TRUE,fixedColumns = TRUE)
             )
p
```

## Variables are stored in both rows and columns (2)

<div class='right' style='float:left;width:45%'>

```{r echo=FALSE, message=FALSE,warning=FALSE}
source("../data/tidy-data/data/weather.r")
library(DT)
p<-datatable(clean1,rownames = FALSE,
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left'))
            ,autoWidth = TRUE)
             )
p
```

</div>

<div class='right' style='float:left;width:10%'>
```{r, echo=FALSE, out.width="90%", fig.cap="", fig.align = 'center'}
url = "https://hotemoji.com/images/dl/i/black-rightwards-arrow-emoji-by-twitter.png"
knitr::include_graphics(url)
```
</div>

<div class='right' style='float:left;width:45%'>
```{r echo=FALSE, message=FALSE,warning=FALSE}
source("../data/tidy-data/data/weather.r")
library(DT)
p<-datatable(clean2,rownames = FALSE,
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left'))
            ,autoWidth = TRUE)
             )
p
```
</div>

## Multiple types in one table (1)


Billboard Ranking

```{r echo=FALSE, message=FALSE,warning=FALSE}
source("../data/tidy-data/data/billboard.r")
p<-datatable(clean,rownames = FALSE,
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left', targets = c(1,2,3,4,5,6)))
            ,autoWidth = TRUE)
             )
p
```

## Multiple types in one table (2)

<div class='right' style='float:left;width:45%'>

Song Table

```{r echo=FALSE, message=FALSE,warning=FALSE}
source("../data/tidy-data/data/billboard.r")
library(DT)
p<-datatable(song,rownames = FALSE,
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left'))
            ,autoWidth = TRUE)
             )
p
```

</div>

<div class='right' style='float:left;width:10%'>
```{r, echo=FALSE, out.width="90%", fig.cap="", fig.align = 'center'}
url = "https://www.svgrepo.com/show/3193/arrows-couple.svg"
knitr::include_graphics(url)
```
</div>

<div class='right' style='float:left;width:45%'>

Ranking Table

```{r echo=FALSE, message=FALSE,warning=FALSE}
source("../data/tidy-data/data/billboard.r")
library(DT)
p<-datatable(rank,rownames = FALSE,
             options = list(pageLength = 10,
            columnDefs = list(list(className = 'dt-left'))
            ,autoWidth = TRUE)
             )
p
```
</div>



## Examples 

**Energy Audit**

This project was conducted in 2018 when I was with GHD. I was the PM for a consultancy project of about 1 million USD for 6 months. The project includes following scope
- Reliability check of all major equipment and systems of 20+ large pump stations in Metro Manila
- Energy Audit
- Conceptual design to upgrade the system

[https://namkyodai.github.io/post/2019-09-15-excel-combine/](https://namkyodai.github.io/post/2019-09-15-excel-combine/)



